<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API密钥号池</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .status-indicator {
                width: 12px;
                height: 12px;
                border-radius: 50%;
            }
            .login-card {
                max-width: 400px;
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 min-h-screen">
    <!-- 登录界面 -->
    <div id="login-screen" class="flex items-center justify-center min-h-screen p-4">
        <div class="login-card bg-white rounded-xl card-shadow p-8">
            <div class="text-center mb-6">
                <i class="fa fa-key text-primary text-4xl mb-4"></i>
                <h1 class="text-2xl font-bold text-dark">Gemini API密钥号池</h1>
                <p class="text-gray-500 mt-2">请输入密码访问控制面板</p>
            </div>
            
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <div class="relative">
                        <input type="password" id="password" name="password" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all pr-10">
                        <i class="fa fa-eye absolute right-3 top-3 text-gray-400 cursor-pointer" id="toggle-password"></i>
                    </div>
                </div>
                <div id="login-error" class="hidden text-danger text-sm"></div>
                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center justify-center">
                    <i class="fa fa-sign-in mr-2"></i>登录
                </button>
            </form>
        </div>
    </div>

    <!-- 主界面 (默认隐藏) -->
    <div id="main-screen" class="hidden min-h-screen flex flex-col">
        <!-- 顶部导航栏 -->
        <header class="bg-white shadow-md">
            <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-2 mb-4 md:mb-0">
                    <i class="fa fa-key text-primary text-2xl"></i>
                    <h1 class="text-2xl font-bold text-dark">Gemini API密钥号池</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <span class="font-medium">后端服务状态:</span>
                        <span id="service-status-indicator" class="status-indicator bg-warning"></span>
                        <span id="service-status-text" class="text-warning font-medium">检查中...</span>
                    </div>
                    <button id="refresh-btn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                        <i class="fa fa-refresh mr-2"></i>刷新
                    </button>
                    <button id="logout-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                        <i class="fa fa-sign-out mr-2"></i>退出
                    </button>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="flex-grow container mx-auto px-4 py-8">
            <!-- 转发URL区域 -->
            <div class="bg-gradient-to-r from-primary/90 to-primary rounded-xl p-6 text-white mb-8 card-shadow">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                    <div>
                        <h2 class="text-xl font-bold mb-2">统一访问接口</h2>
                        <p class="opacity-90 mb-4 md:mb-0">使用此URL访问Gemini API，系统会自动分配可用密钥</p>
                    </div>
                    <div class="w-full md:w-auto">
                        <div class="flex items-center bg-white/10 rounded-lg p-3 w-full">
                            <input type="text" id="proxy-url" readonly 
                                class="bg-transparent border-none text-white font-mono flex-grow focus:outline-none"
                                value="加载中...">
                            <button onclick="copyProxyUrl()" class="ml-2 text-white hover:text-gray-200 transition-colors">
                                <i class="fa fa-copy"></i>
                            </button>
                        </div>
                        <p class="text-sm opacity-80 mt-2">点击复制URL，无需手动指定API密钥</p>
                    </div>
                </div>
            </div>
            
            <!-- 统计卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 card-shadow transform transition-all duration-300 hover:scale-[1.02]">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 mb-1">总密钥数</p>
                            <h3 id="total-keys" class="text-3xl font-bold text-dark">0</h3>
                        </div>
                        <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center">
                            <i class="fa fa-list text-primary text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 card-shadow transform transition-all duration-300 hover:scale-[1.02]">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 mb-1">可用密钥</p>
                            <h3 id="active-keys" class="text-3xl font-bold text-secondary">0</h3>
                        </div>
                        <div class="w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center">
                            <i class="fa fa-check-circle text-secondary text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 card-shadow transform transition-all duration-300 hover:scale-[1.02]">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 mb-1">今日请求数</p>
                            <h3 id="today-requests" class="text-3xl font-bold text-warning">0</h3>
                        </div>
                        <div class="w-12 h-12 bg-warning/10 rounded-full flex items-center justify-center">
                            <i class="fa fa-exchange text-warning text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 密钥列表 -->
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <div class="p-6 border-b border-gray-100">
                    <h2 class="text-xl font-bold text-dark">API密钥列表</h2>
                    <p class="text-gray-500 mt-1">显示所有Gemini API密钥及其状态</p>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">密钥ID</th>
                                <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">密钥（部分隐藏）</th>
                                <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">剩余额度</th>
                                <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">今日使用次数</th>
                                <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">上次检查</th>
                                <th class="px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider">操作</th>
                            </tr>
                        </thead>
                        <tbody id="keys-table-body" class="divide-y divide-gray-200">
                            <!-- 密钥数据将通过JavaScript动态填充 -->
                            <tr>
                                <td colspan="7" class="px-6 py-20 text-center text-gray-500">
                                    <div class="flex flex-col items-center">
                                        <i class="fa fa-spinner fa-spin text-primary text-3xl mb-4"></i>
                                        <p>加载密钥数据中...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 添加密钥表单 -->
            <div class="mt-8 bg-white rounded-xl card-shadow p-6">
                <h2 class="text-xl font-bold text-dark mb-4">添加新密钥</h2>
                <form id="add-key-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="api-key" class="block text-sm font-medium text-gray-700 mb-1">API密钥</label>
                            <input type="text" id="api-key" name="api-key" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                        </div>
                        <div>
                            <label for="key-name" class="block text-sm font-medium text-gray-700 mb-1">密钥名称（可选）</label>
                            <input type="text" id="key-name" name="key-name"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
                        </div>
                    </div>
                    <button type="submit" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all duration-300 flex items-center">
                        <i class="fa fa-plus mr-2"></i>添加密钥
                    </button>
                </form>
            </div>
            
            <!-- 调用示例 -->
            <div class="mt-8 bg-white rounded-xl card-shadow p-6">
                <h2 class="text-xl font-bold text-dark mb-4">调用示例</h2>
                <div class="bg-gray-50 p-4 rounded-lg font-mono text-sm overflow-x-auto">
                    <p class="mb-2 text-gray-700">使用curl调用：</p>
                    <pre class="text-gray-900">curl -X POST <span id="curl-example-url">https://your-domain.com/api/proxy</span> \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-pro",
    "contents": [
      {
        "parts": [{"text": "Hello, world!"}]
      }
    ]
  }'</pre>
                </div>
            </div>
        </main>

        <!-- 页脚 -->
        <footer class="bg-dark text-white py-6">
            <div class="container mx-auto px-4 text-center">
                <p>&copy; 2023 Gemini API密钥号池系统 | 部署于Cloudflare</p>
            </div>
        </footer>
    </div>

    <!-- 通知组件 -->
    <div id="notification" class="fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <i id="notification-icon" class="mr-2"></i>
        <span id="notification-message"></span>
    </div>

    <script>
        // API基础URL
        const API_BASE_URL = '/api';
        // 转发接口URL
        const PROXY_URL = `${window.location.origin}${API_BASE_URL}/proxy`;
        // 认证令牌存储键名
        const AUTH_TOKEN_KEY = 'gemini_key_pool_auth';
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 检查是否已登录
            checkAuthentication();
            
            // 绑定登录表单提交事件
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                login();
            });
            
            // 绑定密码显示/隐藏切换
            document.getElementById('toggle-password').addEventListener('click', togglePasswordVisibility);
            
            // 绑定退出按钮事件
            document.getElementById('logout-btn').addEventListener('click', logout);
        });
        
        // 检查是否已认证
        function checkAuthentication() {
            const token = localStorage.getItem(AUTH_TOKEN_KEY);
            
            if (token) {
                // 验证令牌有效性
                validateToken(token)
                    .then(valid => {
                        if (valid) {
                            // 令牌有效，显示主界面
                            showMainScreen();
                        } else {
                            // 令牌无效，要求重新登录
                            localStorage.removeItem(AUTH_TOKEN_KEY);
                            showLoginScreen();
                        }
                    })
                    .catch(() => {
                        // 验证失败，显示登录界面
                        showLoginScreen();
                    });
            } else {
                // 无令牌，显示登录界面
                showLoginScreen();
            }
        }
        
        // 验证令牌有效性
        async function validateToken(token) {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/validate`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                return response.ok;
            } catch (error) {
                console.error('令牌验证失败:', error);
                return false;
            }
        }
        
        // 登录
        async function login() {
            const passwordInput = document.getElementById('password');
            const password = passwordInput.value;
            const errorElement = document.getElementById('login-error');
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // 存储认证令牌
                    localStorage.setItem(AUTH_TOKEN_KEY, data.token);
                    // 显示主界面
                    showMainScreen();
                    // 重置表单
                    passwordInput.value = '';
                    errorElement.classList.add('hidden');
                } else {
                    // 登录失败
                    errorElement.textContent = '密码错误，请重试';
                    errorElement.classList.remove('hidden');
                }
            } catch (error) {
                errorElement.textContent = '登录失败，请检查网络连接';
                errorElement.classList.remove('hidden');
                console.error('登录错误:', error);
            }
        }
        
        // 退出登录
        function logout() {
            // 清除认证令牌
            localStorage.removeItem(AUTH_TOKEN_KEY);
            // 显示登录界面
            showLoginScreen();
            showNotification('已成功退出登录', 'success');
        }
        
        // 切换密码可见性
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
        
        // 显示登录界面
        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('main-screen').classList.add('hidden');
        }
        
        // 显示主界面并初始化
        function showMainScreen() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            
            // 初始化主界面
            initMainScreen();
        }
        
        // 初始化主界面
        function initMainScreen() {
            // 显示转发URL
            document.getElementById('proxy-url').value = PROXY_URL;
            document.getElementById('curl-example-url').textContent = PROXY_URL;
            
            // 检查服务状态
            checkServiceStatus();
            
            // 加载密钥数据
            loadKeys();
            
            // 绑定刷新按钮事件
            document.getElementById('refresh-btn').addEventListener('click', () => {
                loadKeys();
                checkServiceStatus();
            });
            
            // 绑定添加密钥表单提交事件
            document.getElementById('add-key-form').addEventListener('submit', (e) => {
                e.preventDefault();
                addNewKey();
            });
            
            // 设置定时刷新（每30秒）
            setInterval(() => {
                loadKeys();
                checkServiceStatus();
            }, 30000);
        }
        
        // 复制转发URL到剪贴板
        function copyProxyUrl() {
            const input = document.getElementById('proxy-url');
            input.select();
            document.execCommand('copy');
            
            showNotification('转发URL已复制到剪贴板', 'success');
        }
        
        // 检查后端服务状态
        async function checkServiceStatus() {
            const indicator = document.getElementById('service-status-indicator');
            const statusText = document.getElementById('service-status-text');
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/health`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'UP') {
                        indicator.className = 'status-indicator bg-secondary';
                        statusText.className = 'text-secondary font-medium';
                        statusText.textContent = '正常运行';
                    } else {
                        indicator.className = 'status-indicator bg-danger';
                        statusText.className = 'text-danger font-medium';
                        statusText.textContent = '未正常运行';
                    }
                } else {
                    indicator.className = 'status-indicator bg-danger';
                    statusText.className = 'text-danger font-medium';
                    statusText.textContent = '未正常运行';
                }
            } catch (error) {
                indicator.className = 'status-indicator bg-danger';
                statusText.className = 'text-danger font-medium';
                statusText.textContent = '未正常运行';
            }
        }
        
        // 带认证的请求
        async function fetchWithAuth(url, options = {}) {
            const token = localStorage.getItem(AUTH_TOKEN_KEY);
            
            // 设置默认headers
            const headers = {
                ...options.headers,
                'Authorization': `Bearer ${token}`
            };
            
            // 合并选项
            const fetchOptions = {
                ...options,
                headers
            };
            
            const response = await fetch(url, fetchOptions);
            
            // 处理401未授权错误
            if (response.status === 401) {
                localStorage.removeItem(AUTH_TOKEN_KEY);
                showLoginScreen();
                showNotification('会话已过期，请重新登录', 'error');
                throw new Error('未授权');
            }
            
            return response;
        }
        
        // 加载密钥数据
        async function loadKeys() {
            const tableBody = document.getElementById('keys-table-body');
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/keys`);
                
                if (!response.ok) {
                    throw new Error('获取密钥数据失败');
                }
                
                const data = await response.json();
                const keys = data.keys;
                const stats = data.stats;
                
                renderKeysTable(keys);
                updateStats(keys, stats);
            } catch (error) {
                if (error.message !== '未授权') { // 忽略未授权错误，因为已经处理
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="px-6 py-20 text-center text-gray-500">
                                <div class="flex flex-col items-center">
                                    <i class="fa fa-exclamation-triangle text-warning text-3xl mb-4"></i>
                                    <p>加载密钥数据失败: ${error.message}</p>
                                    <button onclick="loadKeys()" class="mt-4 text-primary hover:underline">重试</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }
        }
        
        // 渲染密钥表格
        function renderKeysTable(keys) {
            const tableBody = document.getElementById('keys-table-body');
            
            if (keys.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-20 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <i class="fa fa-key text-gray-300 text-3xl mb-4"></i>
                                <p>暂无API密钥，请添加新密钥</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = keys.map(key => `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${key.id}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${maskApiKey(key.key)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 rounded-full h-2.5 mr-2">
                                <div class="bg-primary h-2.5 rounded-full" style="width: ${key.remainingQuotaPercentage}%"></div>
                            </div>
                            <span class="text-sm font-medium text-gray-900">${key.remainingQuota} / ${key.totalQuota}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${key.todayUsage || 0}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusBadgeClass(key.status)}">
                            ${getStatusText(key.status)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${formatDate(key.lastChecked)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="testKey('${key.id}')" class="text-primary hover:text-primary/80 mr-3">
                            <i class="fa fa-check-circle mr-1"></i>测试
                        </button>
                        <button onclick="deleteKey('${key.id}')" class="text-danger hover:text-danger/80">
                            <i class="fa fa-trash mr-1"></i>删除
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // 更新统计数据
        function updateStats(keys, stats) {
            const totalKeys = keys.length;
            const activeKeys = keys.filter(key => key.status === 'ACTIVE').length;
            
            document.getElementById('total-keys').textContent = totalKeys;
            document.getElementById('active-keys').textContent = activeKeys;
            document.getElementById('today-requests').textContent = stats?.todayRequests || 0;
        }
        
        // 添加新密钥
        async function addNewKey() {
            const apiKey = document.getElementById('api-key').value;
            const keyName = document.getElementById('key-name').value;
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/keys`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        key: apiKey,
                        name: keyName
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || '添加密钥失败');
                }
                
                // 清空表单
                document.getElementById('add-key-form').reset();
                
                // 重新加载密钥列表
                loadKeys();
                
                // 显示成功通知
                showNotification('密钥添加成功', 'success');
            } catch (error) {
                if (error.message !== '未授权') { // 忽略未授权错误
                    showNotification(error.message, 'error');
                }
            }
        }
        
        // 测试密钥有效性
        async function testKey(keyId) {
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/keys/${keyId}/test`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    throw new Error('测试密钥失败');
                }
                
                // 重新加载密钥列表
                loadKeys();
                
                showNotification('密钥测试成功', 'success');
            } catch (error) {
                if (error.message !== '未授权') { // 忽略未授权错误
                    showNotification('密钥测试失败: ' + error.message, 'error');
                }
            }
        }
        
        // 删除密钥
        async function deleteKey(keyId) {
            if (!confirm('确定要删除这个密钥吗？此操作不可撤销。')) {
                return;
            }
            
            try {
                const response = await fetchWithAuth(`${API_BASE_URL}/keys/${keyId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('删除密钥失败');
                }
                
                // 重新加载密钥列表
                loadKeys();
                
                showNotification('密钥已删除', 'success');
            } catch (error) {
                if (error.message !== '未授权') { // 忽略未授权错误
                    showNotification('删除密钥失败: ' + error.message, 'error');
                }
            }
        }
        
        // 显示通知
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notification-icon');
            const messageEl = document.getElementById('notification-message');
            
            // 设置通知类型样式
            if (type === 'success') {
                notification.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-secondary text-white transform translate-y-0 opacity-100 transition-all duration-300 flex items-center';
                icon.className = 'fa fa-check-circle mr-2';
            } else if (type === 'error') {
                notification.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg bg-danger text-white transform translate-y-0 opacity-100 transition-all duration-300 flex items-center';
                icon.className = 'fa fa-exclamation-circle mr-2';
            }
            
            // 设置消息内容
            messageEl.textContent = message;
            
            // 3秒后隐藏通知
            setTimeout(() => {
                notification.className = 'fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center';
            }, 3000);
        }
        
        // 工具函数：格式化日期
        function formatDate(dateString) {
            if (!dateString) return '从未检查';
            
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // 工具函数：隐藏部分API密钥
        function maskApiKey(key) {
            if (key.length <= 8) return key;
            return key.substring(0, 4) + '...' + key.substring(key.length - 4);
        }
        
        // 工具函数：获取状态标签样式
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'ACTIVE':
                    return 'bg-green-100 text-green-800';
                case 'EXHAUSTED':
                    return 'bg-red-100 text-red-800';
                case 'INVALID':
                    return 'bg-yellow-100 text-yellow-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }
        
        // 工具函数：获取状态文本
        function getStatusText(status) {
            switch (status) {
                case 'ACTIVE':
                    return '可用';
                case 'EXHAUSTED':
                    return '已用尽';
                case 'INVALID':
                    return '无效';
                default:
                    return '未知';
            }
        }
    </script>
</body>
</html>
